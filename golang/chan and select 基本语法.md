1. `func Produce(out chan<- int)`
    
2. `func Consume(in <-chan int)`
    

**ç­”æ¡ˆï¼š**

1. ç¬¬ä¸€ä¸ªæ˜¯â€œç”Ÿäº§è€…â€ï¼Œå®ƒæ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª**åªèƒ½å†™**çš„ç®¡é“ï¼Œå®ƒçš„å·¥ä½œæ˜¯æŠŠæ•°å­—å¾€é‡Œå¡žã€‚
    
2. ç¬¬äºŒä¸ªæ˜¯â€œæ¶ˆè´¹è€…â€ï¼Œå®ƒæ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª**åªèƒ½è¯»**çš„ç®¡é“ï¼Œå®ƒçš„å·¥ä½œæ˜¯ä»Žé‡Œå¾€å¤–æ‹¿ã€‚


```go
func worker(id int, queue <-chan InferenceRequest) {  
    for req := range queue {  
       fmt.Printf("[Worker %d] æ­£åœ¨å¤„ç†: %s\n", id, req.Prompt)  
  
       // æ¨¡æ‹ŸæŽ¨ç†è€—æ—¶ (2-4ç§’)  
       time.Sleep(3 * time.Second)  
  
       // å°†ç»“æžœå‘å›ž  
       select {  
       case req.ResultChan <- fmt.Sprintf("è¿™æ˜¯å…³äºŽ '%s' çš„å¤§æ¨¡åž‹å›žå¤", req.Prompt):  
       case <-time.After(1 * time.Second): // é˜²æ­¢ç»“æžœé€šé“é˜»å¡ž  
          fmt.Printf("[Worker %d] ç»“æžœå‘é€å¤±è´¥ï¼Œè¯·æ±‚å¯èƒ½å·²è¶…æ—¶\n", id)  
       }  
    }  
}
```
å…¶ä¸­, å…¥å‚éƒ¨åˆ†çš„`queue <-chan InferenceRequest` è¯´æ˜Ž, è¿™é‡Œçš„`queue` æ˜¯ä¸€ä¸ª `chan`, å¹¶ä¸”è¿™ä¸ª`chan` æ˜¯åªèƒ½`<-` å¾€å¤–æ‹¿ä¸œè¥¿çš„, å¹¶ä¸”`chan`ä¸­è£…çš„æ˜¯`InferenceRequest`ç±»åž‹çš„ä¸œè¥¿


---

## ðŸ“ Go è¯­è¨€ `select` å¹¶å‘æ ¸å¿ƒç¬”è®°

### 1. å®šä½ä¸Žæœ¬è´¨

- **æœ¬è´¨**ï¼š`select` æ˜¯ä¸“é—¨ä¸º **Channelï¼ˆç®¡é“ï¼‰** è®¾è®¡çš„é€»è¾‘å¼€å…³ã€‚
    
- **å¯¹æ¯”**ï¼š
    
    - `switch`ï¼šåŸºäºŽ **å€¼** çš„æ¯”è¾ƒï¼ˆå¦‚ `x == 10`ï¼‰ã€‚
        
    - `select`ï¼šåŸºäºŽ **é€šä¿¡äº‹ä»¶** çš„ç›‘å¬ï¼ˆå¦‚â€œç®¡é“èƒ½å¦è¯»å†™â€ï¼‰ã€‚
        

### 2. æ ¸å¿ƒè¯­æ³•ç»“æž„

Go

```
select {
case ch1 <- data:
    // å¦‚æžœæ•°æ®æˆåŠŸå¡žè¿›ç®¡é“ï¼Œæ‰§è¡Œæ­¤å—
case v := <- ch2:
    // å¦‚æžœä»Žç®¡é“æˆåŠŸæ‹¿åˆ°æ•°æ®ï¼Œæ‰§è¡Œæ­¤å—
case <-time.After(time.Second):
    // å¦‚æžœ 1 ç§’é’Ÿå†…ä»¥ä¸Šéƒ½æ²¡å‘ç”Ÿï¼Œæ‰§è¡Œæ­¤å—ï¼ˆè¶…æ—¶æŽ§åˆ¶ï¼‰
default:
    // å¦‚æžœæ‰€æœ‰ç®¡é“éƒ½é˜»å¡žï¼Œç«‹åˆ»æ‰§è¡Œæ­¤å—ï¼ˆéžé˜»å¡žæŽ¢æµ‹ï¼‰
}
```

### 3. ä¸‰å¤§é»„é‡‘æ³•åˆ™ï¼ˆåº•å±‚è¡Œä¸ºï¼‰

- èƒ½åšæ‰åšï¼ˆåŽŸå­æ€§ï¼‰ï¼š
    
    æ¯ä¸ª case ä»£è¡¨ä¸€ä¸ªåŠ¨ä½œã€‚select ä¼šæŽ¢æµ‹åŠ¨ä½œæ˜¯å¦èƒ½å®Œæˆã€‚æŽ¢æµ‹ï¼ˆæ£€æŸ¥ç®¡é“æ»¡æ²¡æ»¡ï¼‰å’Œæ‰§è¡Œï¼ˆå¡žè¿›åŽ»ï¼‰æ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„åŽŸå­æ“ä½œã€‚
    
- éƒ½ä¸è¡Œå°±ç­‰ï¼ˆé˜»å¡žæŒ‚èµ·ï¼‰ï¼š
    
    å¦‚æžœæ²¡æœ‰ä»»ä½• case å‡†å¤‡å°±ç»ªï¼Œå½“å‰çš„ Goroutine ä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œä¸æ¶ˆè€— CPUï¼Œç›´åˆ°æŸä¸ªç®¡é“å˜ readyã€‚
    
- è¡Œäº†å¤šä¸ªå°±éšæœºï¼ˆå…¬å¹³ç«žäº‰ï¼‰ï¼š
    
    å¦‚æžœå¤šä¸ªç®¡é“åŒæ—¶å‡†å¤‡å¥½äº†ï¼Œselect ä¼šéšæœºæŒ‘é€‰ä¸€ä¸ªæ‰§è¡Œï¼Œé˜²æ­¢æŸä¸ªé«˜é¢‘ç®¡é“è®©å…¶ä»–ç®¡é“â€œé¥¿æ­»â€ã€‚
    

### 4. å…³é”®ç¬¦å·ç†è§£

- **ç®­å¤´ `<-`**ï¼šä»£è¡¨æ•°æ®æµå‘ã€‚`ch <- v` æ˜¯å‘é€ï¼Œ`<-ch` æ˜¯æŽ¥æ”¶ã€‚
    
- **å†’å· `:`**ï¼šæ ‡è®°â€œäº‹ä»¶è§¦å‘â€åŽçš„ä»£ç èµ·ç‚¹ã€‚å¦‚æžœå†’å·åŽä¸ºç©ºï¼Œè¡¨ç¤ºâ€œåŠ¨ä½œå®Œæˆå³ç»“æŸï¼Œæ— éœ€åŽç»­æ“ä½œâ€ã€‚
    

### 5. LLM éƒ¨ç½²ä¸­çš„å®žæˆ˜æ„ä¹‰

- **é˜²å¡æ­»ï¼ˆSelf-Protectionï¼‰**ï¼šé€šè¿‡ `time.After` ç«žäº‰ï¼Œç¡®ä¿ Worker ä¸ä¼šå› ä¸ºç”¨æˆ·æ–­å¼€è¿žæŽ¥è€Œæ°¸ä¹…å¡åœ¨â€œå‘é€ç»“æžœâ€è¿™ä¸€æ­¥ã€‚
    
- **èƒŒåŽ‹å¤„ç†ï¼ˆBackpressureï¼‰**ï¼šé€šè¿‡å¸¦ `default` çš„ `select`ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ç«‹å³æ‹’ç»æ–°è¯·æ±‚ï¼Œä¿æŠ¤æœåŠ¡å™¨ä¸å®•æœºã€‚
    

---

### ðŸ’¡ æ·±åº¦ç†è§£ï¼šä¸ºä»€ä¹ˆæ²¡æœ‰å¸ƒå°”å€¼ï¼Ÿ

åœ¨å¹¶å‘ä¸–ç•Œé‡Œï¼Œ**â€œå…ˆæ£€æŸ¥å†æ‰§è¡Œâ€** æ˜¯ä¸‡æ¶ä¹‹æºã€‚

- âŒ é”™è¯¯æ€ç»´ï¼š`if ch.isNotFull() { ch <- data }` ï¼ˆæ£€æŸ¥å®ŒåŽï¼Œå¯èƒ½ç«‹åˆ»å˜æ»¡ï¼‰ã€‚
    
- âœ… Go ä¹‹é“ï¼š`case ch <- data:` ï¼ˆå°è¯•æ‰§è¡Œï¼ŒæˆåŠŸäº†å°±ç®—ä¸­é€‰ï¼‰ã€‚è¿™ä¿è¯äº†æ“ä½œçš„**åŽŸå­æ€§ (Atomicity)**ã€‚
    

---
